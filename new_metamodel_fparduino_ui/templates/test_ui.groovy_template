<html ng-app="uiGen">

<head>
    <title>HelloWorld</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.1.2/ui-bootstrap-tpls.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://bootswatch.com/paper/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <style>
        .content {
            font-size: 21px;
            font-weight: 300;
            line-height: 1.4;
        }
    </style>
    <script>
        var uigen = angular.module("uiGen", ['ui.bootstrap']);
        uigen.controller("UiGenCtrl", ['\$scope', '\$http', '\$interval', '\$location', function(\$scope, \$http, \$interval, \$location) {
			\$scope.freeMem = 0;
            var boardUrl = (\$location.search().boardUrl != undefined ? \$location.search().boardUrl : "");
			var statusUrl, descriptorsUrl;
			if(boardUrl != ""){
				statusUrl = 'http://' + boardUrl + '/getState';
				descriptorsUrl = "getDescriptors2";
			}else{
				statusUrl = "getStatus";
				descriptorsUrl = "getDescriptors"
			}
			
			var getDescriptorsValues = function(elements){
					\$scope.freeMem = elements.FREE_MEM;
                    for (var i = 0; i < \$scope.descriptors.elems.length; i++) {
                        \$scope.descriptors.elems[i].value = eval("elements." + \$scope.descriptors.elems[i].name);
                    }
			}
            var checkStatus = function() {
                \$http.get(statusUrl).success(function(response) {
					getDescriptorsValues(response);
                })
            };
            \$interval(checkStatus, 1000);
            \$http.get(descriptorsUrl).success(function(response) {
                \$scope.descriptors = response;
            })
            \$scope.invoke = function(path, successHandler, errorHandler) {
                \$http.get("http://" + boardUrl +"/" + path).success(function(response) {
					getDescriptorsValues(response);
                });
            }
        }]);
    </script>
</head>

<body class="content" ng-controller="UiGenCtrl">
    <br/>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-4 col-md-offset-4">
                <div class="panel panel-primary text-center">
                    <div class="panel-heading">Status</div>
                    <div class="panel-body">
                        <div ng-repeat="elem in descriptors.elems">
                            <span> Value of {{elem.label}} is {{elem.value}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 col-md-offset-4">
                <div class="panel panel-primary text-center">
                    <div class="panel-heading">Commands</div>
                    <div class="panel-body">
                        <button ng-repeat="button in descriptors.commands" class="btn btn-block btn-lg" type="button" ng-click="invoke(button.onclick)">
							{{button.text}}
						</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class=" col-md-8 col-md-offset-4"><span class="label label-default"><span class="glyphicon glyphicon-dashboard"></span> Free memory (SRAM): {{freeMem}} bytes</span>
            </div>
        </div>
    </div>
</body>

</html>